<!-- Optimization Status Partial Template -->
<div class="bg-white shadow rounded-lg p-6 mb-4" 
     hx-get="/htmx/optimization-status/{{ optimization_id }}" 
     hx-trigger="every 2s"
     hx-swap="outerHTML">
    
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-medium text-gray-900">
            <i class="fas fa-cog mr-2"></i>
            Optimization in Progress
        </h3>
        <div class="flex items-center">
            {% if optimization.status == 'running' %}
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                <span class="text-sm text-blue-600 font-medium">Running</span>
            {% elif optimization.status == 'completed' %}
                <div class="h-4 w-4 bg-green-500 rounded-full mr-2"></div>
                <span class="text-sm text-green-600 font-medium">Completed</span>
            {% elif optimization.status == 'failed' %}
                <div class="h-4 w-4 bg-red-500 rounded-full mr-2"></div>
                <span class="text-sm text-red-600 font-medium">Failed</span>
            {% else %}
                <div class="h-4 w-4 bg-gray-500 rounded-full mr-2"></div>
                <span class="text-sm text-gray-600 font-medium">{{ optimization.status.title() }}</span>
            {% endif %}
        </div>
    </div>

    <!-- Progress Bar -->
    {% if optimization.status in ['running', 'completed'] %}
    <div class="mb-4">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
            <span>Progress</span>
            <span>{{ optimization.get('progress', 0) }}%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out" 
                 style="width: {{ optimization.get('progress', 0) }}%"></div>
        </div>
    </div>
    {% endif %}

    <!-- Optimization Details -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
            <dt class="text-sm font-medium text-gray-500">Type</dt>
            <dd class="text-sm text-gray-900">{{ optimization.request.optimization_type.title() }}</dd>
        </div>
        <div>
            <dt class="text-sm font-medium text-gray-500">Started</dt>
            <dd class="text-sm text-gray-900">{{ optimization.start_time.strftime('%H:%M:%S') }}</dd>
        </div>
        <div>
            <dt class="text-sm font-medium text-gray-500">Duration</dt>
            <dd class="text-sm text-gray-900">
                {% set duration = (loop.now if not optimization.get('end_time') else optimization.end_time) - optimization.start_time %}
                {{ format_duration(duration.total_seconds()) }}
            </dd>
        </div>
    </div>

    <!-- Results (if completed) -->
    {% if optimization.status == 'completed' and optimization.get('result') %}
    <div class="border-t border-gray-200 pt-4">
        <h4 class="text-sm font-medium text-gray-900 mb-2">Results</h4>
        <div class="bg-green-50 border border-green-200 rounded-md p-3">
            <p class="text-sm text-green-700">{{ optimization.result.message }}</p>
            
            {% if optimization.result.data %}
            <div class="mt-2 grid grid-cols-2 gap-4">
                {% for key, value in optimization.result.data.items() %}
                <div>
                    <dt class="text-xs font-medium text-green-600">{{ key.replace('_', ' ').title() }}</dt>
                    <dd class="text-sm text-green-900">{{ value }}</dd>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Error (if failed) -->
    {% if optimization.status == 'failed' %}
    <div class="border-t border-gray-200 pt-4">
        <h4 class="text-sm font-medium text-gray-900 mb-2">Error</h4>
        <div class="bg-red-50 border border-red-200 rounded-md p-3">
            <p class="text-sm text-red-700">
                {% if optimization.get('error') %}
                    {{ optimization.error }}
                {% else %}
                    Optimization failed. Please try again.
                {% endif %}
            </p>
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="border-t border-gray-200 pt-4 flex justify-end space-x-3">
        {% if optimization.status == 'completed' %}
            <button type="button" 
                    class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <i class="fas fa-download mr-2"></i>
                Export Report
            </button>
        {% endif %}
        
        {% if optimization.status in ['failed', 'completed'] %}
            <button type="button" 
                    onclick="this.parentElement.parentElement.remove()"
                    class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                <i class="fas fa-times mr-2"></i>
                Dismiss
            </button>
        {% endif %}
    </div>
</div>