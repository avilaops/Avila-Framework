import { gaServerEvent, generateClientId } from "./ga-server"; interface EmailParams { to: string; accountId: string; campaign: string; template: string; } export async function sendPulseEmail(params: EmailParams) { const { accountId, campaign } = params; const reportUrl = buildURLWithUTM(`https://pulse.avila.com/report/${accountId}`, { utm_source: "email", utm_medium: "drip", utm_campaign: campaign }); const clientId = generateClientId(accountId); await gaServerEvent(clientId, "view_report_email", { env: (process.env.NODE_ENV as any) || "dev", account_id: accountId, campaign }); return reportUrl; } function buildURLWithUTM(baseUrl: string, utm: Record<string, string>): string { const url = new URL(baseUrl); Object.entries(utm).forEach(([key, value]) => { url.searchParams.set(key, value); }); return url.toString(); }